<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta charset="UTF-8">
  <title>File System Access API demo for iOS/Mac</title>
  <script type="module">
    const root = await navigator.storage.getDirectory();
    let directoryName;
    const updateDirsAndFiles = async () => {
      let str = '';
      for await (const handle of root.values()) {
        if (handle.kind === 'directory') {
          str += handle.name;
          let hasFile = false
          for await (const file of handle.values()) {
            if (file.kind === 'file') {
              if (!hasFile) {
                str += ', files: '
              }
              hasFile = true;
              str += `${file.name},`;
            }
          }
          str = `${hasFile ? str.slice(0, -1) : str}. `;
        }
      }
      document.querySelector('#dirsAndFiles').innerHTML = str;
    };

    document.querySelector('#addDirectory').addEventListener('submit', async e => {
      e.preventDefault();
      directoryName = e.target[0].value;
      await root.getDirectoryHandle(directoryName, { "create" : true });
      document.querySelector('#createdDirectory').innerHTML = `Directory ${directoryName} created!`;
      await updateDirsAndFiles();
    });

    document.querySelector('#saveFile').addEventListener('submit', async e => {
      e.preventDefault();
      const fileName = e.target[0].value;
      const fileContent = e.target[0].value;
      const fileHandle = await root.getFileHandle(`${fileName}.txt`, { "create" : true });
      const fileAccessHandle = await fileHandle.createSyncAccessHandle();
      const data = new TextEncoder().encode(fileContent);
      await fileAccessHandle.write(data, { at: 0 });
      await updateDirsAndFiles();
    });

    await updateDirsAndFiles();
  </script>
</head>
<body>
<header>
  <h1>
    File System Access API demo for iOS/Mac
  </h1>
  <div>
    iOS and Mac support File System Access API with Origin Private File System - "regular" files on disk are not available
    <br>
    Check article: <a href="https://webkit.org/blog/12257/the-file-system-access-api-with-origin-private-file-system/">The File System Access API with Origin Private File System</a>
  </div>
</header>
<main>
<section>
  <h2>Add directory</h2>
  <form id="addDirectory">
    <label for="directoryName">Directory name</label>
    <input type="text" id="directoryName">
    <br>
    <button type="submit">add directory</button>
  </form>
  <output for="directoryName" id="createdDirectory"></output>
</section>
</main>
<section>
  <h2>Save file in that directory</h2>
  <form id="saveFile">
    <label for="fileName">File name</label>
    <input type="text" id="fileName">
    <br>
    <label for="fileContent">File content</label>
    <textarea id="fileContent"></textarea>
    <button type="submit">Save file</button>
  </form>
  <output for="fileName" id="createdFile"></output>
</section>
<section>
  <h2>Currently created dirs and files in them</h2>
  <output for="directoryName fileName" id="dirsAndFiles"></output>
</section>
</main>
<footer>
  <address>
    Repository:
    <a href="https://github.com/radek-anuszewski/file-system-acces-api-ios-mac">File system acess API iOS / Mac</a>
  </address>
</footer>
</body>
</html>